<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Data Cleaning Methods • acresFSA</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Data Cleaning Methods">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">acresFSA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/acresFSA.html">Getting Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/1_compile.html">Compilation Methods</a></li>
    <li><a class="dropdown-item" href="../articles/2_clean.html">Data Cleaning Methods</a></li>
    <li><a class="dropdown-item" href="../articles/acresfsa.html">acresFSA</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/capellett/acresFSA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Data Cleaning Methods</h1>
                        <h4 data-toc-skip class="author">C Alex
Pellett</h4>
            
            <h4 data-toc-skip class="date">2024-12-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/capellett/acresFSA/blob/master/vignettes/2_clean.Rmd" class="external-link"><code>vignettes/2_clean.Rmd</code></a></small>
      <div class="d-none name"><code>2_clean.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="data-cleaning-and-validation">Data Cleaning and Validation<a class="anchor" aria-label="anchor" href="#data-cleaning-and-validation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>message<span class="op">=</span><span class="cn">FALSE</span>, warning<span class="op">=</span><span class="cn">FALSE</span>, eval<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org" class="external-link">readxl</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fsa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">'../data-raw/acresFSA_compilation.rds'</span><span class="op">)</span></span>
<span><span class="va">fsa</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">fsa</span>, `County Name` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="va">`County Name`</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### TODO: use these libraries.</span></span>
<span><span class="co">### install.packages('validate', 'errorlocate); library(validate); library(errorlocate)</span></span>
<span></span>
<span><span class="co">## Convert any values of 'NULL', 'null', 'NA', or 'na' to NA_character_</span></span>
<span></span>
<span><span class="co">## Test that all State Codes are 2 characters, and all County Codes are 3 characters.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">fsa</span><span class="op">$</span><span class="va">`State Code`</span><span class="op">)</span><span class="op">)</span><span class="op">==</span><span class="fl">2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">fsa</span><span class="op">$</span><span class="va">`County Code`</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">3</span></span></code></pre></div>
<div class="section level3">
<h3 id="test-year-values">Test year values<a class="anchor" aria-label="anchor" href="#test-year-values"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">fsa</span><span class="op">$</span><span class="va">Year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Look right, afterall, I created those values in the previous
script.</p>
</div>
<div class="section level3">
<h3 id="test-state-code-state-name-and-state-abbreviation-values">Test State Code, State Name, and State Abbreviation values<a class="anchor" aria-label="anchor" href="#test-state-code-state-name-and-state-abbreviation-values"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fsa</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">select</span><span class="op">(</span><span class="va">`State Code`</span>, <span class="va">`State Name`</span>, <span class="va">`State Abbrev`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">arrange</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>USA state codes skip some numbers (eg, 03).</p>
</div>
<div class="section level3">
<h3 id="test-that-the-state-county-code-is-truly-the-concatenation-of-state-and-county-codes-">Test that the State County Code is truly the concatenation of state
and county codes.<a class="anchor" aria-label="anchor" href="#test-that-the-state-county-code-is-truly-the-concatenation-of-state-and-county-codes-"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">test1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">fsa</span>, <span class="va">`State County Code`</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">`State Code`</span>, <span class="va">`County Code`</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">select</span><span class="op">(</span><span class="va">Year</span>, <span class="va">`State Code`</span>, <span class="va">`County Code`</span>, <span class="va">`State County Code`</span>, <span class="va">`State Name`</span>, <span class="va">`County Name`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">test1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">arrange</span><span class="op">(</span><span class="va">Year</span>, <span class="va">`State Name`</span>, <span class="va">`County Name`</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">test1</span><span class="op">$</span><span class="va">`State Code`</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">test1</span><span class="op">$</span><span class="va">`State County Code`</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## for some years, the leading zeros in State County Code got dropped.</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fsa</span> <span class="op">&lt;-</span> <span class="va">fsa</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>`State County Code` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">`State Code`</span>, <span class="va">`County Code`</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">`State Code`</span>, <span class="op">-</span><span class="va">`State Abbrev`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">rename</span><span class="op">(</span>State <span class="op">=</span> <span class="st">'State Name'</span><span class="op">)</span></span></code></pre></div>
<p>Since that appears to be correct, the columns for State Code and
State Abbreviation are redundant and have been removed.</p>
</div>
<div class="section level3">
<h3 id="test-the-county-names-are-uniform">Test the County Names are uniform<a class="anchor" aria-label="anchor" href="#test-the-county-names-are-uniform"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">duped</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">x</span>, fromLast<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">}</span></span>
<span></span>
<span><span class="co">### Return cases where 1:1 fails</span></span>
<span><span class="va">one_to_one_fails</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">id1</span>, <span class="va">id2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">id1</span>, <span class="va">id2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="va">.</span><span class="op">[</span><span class="fu">duped</span><span class="op">(</span><span class="va">.</span><span class="op">[</span>,<span class="va">id1</span><span class="op">]</span><span class="op">)</span> <span class="op">|</span> <span class="fu">duped</span><span class="op">(</span><span class="va">.</span><span class="op">[</span>,<span class="va">id2</span><span class="op">]</span><span class="op">)</span>,<span class="op">]</span> <span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Test that State+County is 1:1 with 'State County Code'</span></span>
<span><span class="co"># one_to_one_fails(fsa, c('State', 'County Name'), 'State County Code') %&gt;% nrow()</span></span>
<span><span class="co">#### Should be nrow 0, is nrow 835...</span></span>
<span><span class="co">#### Caused by variation in county names</span></span>
<span></span>
<span><span class="co"># length(unique(fsa$`State County Code`))</span></span>
<span><span class="co"># filter(fsa, Year==2016)$`State County Code` %&gt;%</span></span>
<span><span class="co">#   unique() %&gt;% length()</span></span>
<span><span class="co">#### Apparently, not all state county codes are in every year...</span></span>
<span></span>
<span><span class="va">county_name_recode</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">fsa</span>, <span class="st">'State County Code'</span>, <span class="st">'County Name'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">`State County Code`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">do</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">county_names</span> <span class="op">&lt;-</span> <span class="va">.</span><span class="op">$</span><span class="va">`County Name`</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">str_replace_all</span><span class="op">(</span><span class="st">"\\."</span>, <span class="st">''</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">str_replace_all</span><span class="op">(</span><span class="st">'&amp;#39;'</span>, <span class="st">''</span><span class="op">)</span></span>
<span>    <span class="va">county_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">",.*"</span>,<span class="st">""</span>,<span class="va">county_names</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="fu">tibble</span><span class="op">(</span>County<span class="op">=</span> <span class="va">county_names</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">county_names</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">`State County Code`</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fsa</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">fsa</span>, <span class="op">-</span><span class="va">`County Name`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">inner_join</span><span class="op">(</span><span class="va">county_name_recode</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Test again that 'State'+'County' is 1:1 with 'State County Code'</span></span>
<span><span class="co"># one_to_one_fails(fsa, c('State', 'County'), 'State County Code') %&gt;% nrow() == 0</span></span>
<span><span class="co">#### Then drop State County Code</span></span>
<span><span class="va">fsa</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">fsa</span>, <span class="op">-</span><span class="va">`State County Code`</span><span class="op">)</span></span>
<span><span class="va">fsa</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">select</span><span class="op">(</span><span class="va">fsa</span>, <span class="op">-</span><span class="st">'County Code'</span><span class="op">)</span></span></code></pre></div>
<p>There are some instances of counties with changes to the county name
over the different years. After removing a few stray punctuation marks,
the county names are made uniform by replacing the variations with the
version of that county name which has the most characters in it
(letters, spaces, and punctation). Once that operation is performed, the
State County Code and County Code columns are no longer relevant, so
they are dropped.</p>
</div>
<div class="section level3">
<h3 id="test-that-crop-values-are-uniform">Test that Crop values are uniform<a class="anchor" aria-label="anchor" href="#test-that-crop-values-are-uniform"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#### Just like for the State_table and county_name_recode,</span></span>
<span><span class="co">###  create an authoritative reference table for Crops &amp; crop types</span></span>
<span><span class="co">### that will allow dropping code columns.</span></span>
<span></span>
<span><span class="co">## Test that Crop Name is 1:1 with Crop Code</span></span>
<span><span class="co"># one_to_one_fails(fsa, 'Crop Name', 'Crop Code') %&gt;% View()</span></span>
<span><span class="co">### Should be 0, is 49.</span></span>
<span></span>
<span><span class="va">recode_column_with_table</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">col_index</span>, <span class="va">recode_table</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df2</span> <span class="op">&lt;-</span> <span class="va">df</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df2</span><span class="op">)</span><span class="op">[</span><span class="va">col_index</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'from'</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'recoding '</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">[</span><span class="va">col_index</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">df</span><span class="op">[</span><span class="va">col_index</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">df2</span>, <span class="va">recode_table</span>, by<span class="op">=</span><span class="st">'from'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>to<span class="op">=</span><span class="fu">if_else</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">to</span><span class="op">)</span>, <span class="va">from</span>, <span class="va">to</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">.</span><span class="op">$</span><span class="va">to</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">}</span></span>
<span></span>
<span><span class="co">### Recode crop names.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">fsa</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Crop Name'</span>, <span class="st">'Year'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="st">'Crop Names per Year.csv'</span><span class="op">)</span></span>
<span><span class="fu">one_to_one_fails</span><span class="op">(</span><span class="va">fsa</span>, <span class="st">'Crop Name'</span>, <span class="st">'Crop Code'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="st">'Crop codes with multiple names.csv'</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># crop_name_recode &lt;- read_xlsx("data-raw\\FSA - Clean up the names.xlsx", sheet = 'crop name recode')</span></span>
<span><span class="co"># fsa &lt;- recode_column_with_table(fsa, 3, crop_name_recode)</span></span>
<span></span>
<span><span class="va">crop_name_recode</span> <span class="op">&lt;-</span> <span class="fu">read_xlsx</span><span class="op">(</span><span class="st">"FSA - Clean up the names.xlsx"</span>, sheet <span class="op">=</span> <span class="st">'crop name recode (2)'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>`Crop Code` <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu">str_pad</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">`Crop Code`</span><span class="op">)</span>, width<span class="op">=</span><span class="fl">4</span>, side<span class="op">=</span><span class="st">"left"</span>, pad<span class="op">=</span><span class="st">"0"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fsa</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">bind_rows</span><span class="op">(</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">anti_join</span><span class="op">(</span><span class="va">fsa</span>, <span class="va">crop_name_recode</span>, by<span class="op">=</span><span class="st">"Crop Code"</span><span class="op">)</span>,</span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">semi_join</span><span class="op">(</span><span class="va">fsa</span>, <span class="va">crop_name_recode</span>, by<span class="op">=</span><span class="st">"Crop Code"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">`Crop Name`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">left_join</span><span class="op">(</span><span class="va">crop_name_recode</span>, by<span class="op">=</span><span class="st">"Crop Code"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># one_to_one_fails(fsa, 'Crop Name', 'Crop Code') %&gt;% nrow() == 0 ## TRUE</span></span>
<span></span>
<span><span class="va">fsa</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">select</span><span class="op">(</span><span class="va">fsa</span>, <span class="op">-</span><span class="va">`Crop Code`</span><span class="op">)</span></span></code></pre></div>
<p>There are some cases of multiple crop names associated with a single
crop code. Those cases have been reviewed and the varying crop names
have been replaced with whichever one among them appears most
appropriate. Then, the Crop Code column is dropped because it is no
longer needed.</p>
</div>
<div class="section level3">
<h3 id="test-the-crop-type-values-are-uniform">Test the Crop Type values are uniform<a class="anchor" aria-label="anchor" href="#test-the-crop-type-values-are-uniform"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter(fsa, !is.na(`Crop Type`)) %&gt;%</span></span>
<span><span class="co">#   one_to_one_fails('Crop Type Name', 'Crop Type') %&gt;% View() ## 420 rows.</span></span>
<span></span>
<span><span class="co">## Test that Crop Name + Crop Type Name is 1:many with Crop Type</span></span>
<span><span class="co"># fsa[,c('Crop Name', 'Crop Type Name', 'Crop Type')] %&gt;%</span></span>
<span><span class="co">#   filter(!is.na(`Crop Type`)) %&gt;% unique() %&gt;%</span></span>
<span><span class="co">#   .[duped(.[,c('Crop Name', 'Crop Type Name')]),]</span></span>
<span><span class="co">## Should be nrow 0. is nrow 0.</span></span>
<span></span>
<span><span class="co"># fsa %&gt;% </span></span>
<span><span class="co">#   dplyr::select(`Crop Name`, `Crop Type Name`, `Crop Type`) %&gt;% </span></span>
<span><span class="co">#   unique() %&gt;%</span></span>
<span><span class="co">#   scutils::dupes(idCols="Crop Type") %&gt;% View()</span></span>
<span></span>
<span><span class="va">crop_type_name_recode</span> <span class="op">&lt;-</span> <span class="va">fsa</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">select</span><span class="op">(</span><span class="va">`Crop Name`</span>, <span class="va">`Crop Type Name`</span>, <span class="va">`Crop Type`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">`Crop Type`</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">scutils</span><span class="fu">::</span><span class="fu">dupes</span><span class="op">(</span><span class="va">.</span>, idCols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Crop Name"</span>, <span class="st">"Crop Type"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">group_by</span><span class="op">(</span><span class="va">`Crop Name`</span>, <span class="va">`Crop Type`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">summarise</span><span class="op">(</span>`Crop Type Name` <span class="op">=</span> <span class="va">`Crop Type Name`</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">`Crop Type Name`</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fsa</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">bind_rows</span><span class="op">(</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">anti_join</span><span class="op">(</span><span class="va">fsa</span>, <span class="va">crop_type_name_recode</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Crop Name'</span>, <span class="st">'Crop Type'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">semi_join</span><span class="op">(</span><span class="va">fsa</span>, <span class="va">crop_type_name_recode</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Crop Name'</span>, <span class="st">'Crop Type'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">`Crop Type Name`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">left_join</span><span class="op">(</span><span class="va">crop_type_name_recode</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Crop Name'</span>, <span class="st">'Crop Type'</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">## test that it worked</span></span>
<span><span class="co"># fsa %&gt;% </span></span>
<span><span class="co">#   dplyr::select(`Crop Name`, `Crop Type Name`, `Crop Type`) %&gt;% </span></span>
<span><span class="co">#   unique() %&gt;%</span></span>
<span><span class="co">#   dplyr::filter(!is.na(`Crop Type`)) %&gt;%</span></span>
<span><span class="co">#   scutils::dupes(., idCols=c("Crop Name", "Crop Type"))</span></span>
<span><span class="co">## should be nrow() == 0, and it is.</span></span>
<span></span>
<span><span class="co">### Old Code</span></span>
<span><span class="co"># ### Recode Crop Type Names</span></span>
<span><span class="co"># table(fsa_[c('Crop Type Name', 'Year')]) %&gt;% write.csv('data-raw\\Crop Type Names per Year.csv')</span></span>
<span><span class="co"># crop_type_name_recode &lt;- read_xlsx("data-raw\\FSA - Clean up the names.xlsx",</span></span>
<span><span class="co">#                                    sheet='crop type name recode')</span></span>
<span><span class="co"># fsa &lt;- recode_column_with_table(fsa, 4, crop_type_name_recode)</span></span>
<span></span>
<span><span class="va">fsa</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">select</span><span class="op">(</span><span class="va">fsa</span>, <span class="op">-</span><span class="va">`Crop Type`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">rename</span><span class="op">(</span>Crop<span class="op">=</span><span class="st">'Crop Name'</span>, Variety<span class="op">=</span><span class="st">'Crop Type Name'</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"../R/track_dataset.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/track_dataset.html">track_dataset</a></span><span class="op">(</span><span class="va">fsa</span>, <span class="st">'Tested and removed redundant columns'</span><span class="op">)</span></span></code></pre></div>
<p>The Crop Type column contains 3 letter abbreviations of the values in
the Crop Type Name column. The Crop Type abbreviations can be repeated
for different crops. For example Crop Type of “CAN” might refer to
Canary Grass, Carnelian Grapes, Canna Lily Flowers, or several other
crops. That seems reasonable, but there are some cases where a single
Crop Type abbreviation value is used to refer to multiple Crop Type Name
values for the same Crop. In those cases, the Crop Type Name with the
most characters is selected, as it is probably the most descriptive. At
that point, the Crop Type abbreviation is redundant, so the column is
dropped. The” “Crop Type Name” column is renamed to “Variety”.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## This chunk of code is outdated and no longer needed.</span></span>
<span></span>
<span></span>
<span><span class="co">### Recode crop names and crop type names together ...</span></span>
<span><span class="co">### Make a table with unique crop code, crop name, crop type name, and crop type - by year</span></span>
<span><span class="va">crop_classification_review</span> <span class="op">&lt;-</span> <span class="va">fsa</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>`Crop Type Name` <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span></span>
<span>    <span class="va">`Crop Type Name`</span><span class="op">==</span><span class="st">'NULL'</span>, <span class="cn">NA_character_</span>, <span class="va">`Crop Type Name`</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">Year</span>, <span class="va">`Crop Code`</span>, <span class="va">`Crop Name`</span>, <span class="va">`Crop Type Name`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>Acres<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Acres</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">spread</span><span class="op">(</span><span class="st">'Year'</span>, <span class="st">'Acres'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">crop_classification_review</span>, <span class="st">'data-raw\\Crop Classification Review.csv'</span><span class="op">)</span></span>
<span><span class="va">crop_name_and_type_recode</span> <span class="op">&lt;-</span> <span class="fu">read_xlsx</span><span class="op">(</span><span class="st">"data-raw\\FSA - Clean up the names.xlsx"</span>,</span>
<span>                                       sheet<span class="op">=</span><span class="st">'crop name and type recode'</span>,</span>
<span>                                       col_types<span class="op">=</span><span class="st">'text'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>`Crop Code`<span class="op">=</span><span class="fu">str_pad</span><span class="op">(</span><span class="va">`Crop Code`</span>, <span class="fl">4</span>, <span class="st">'left'</span>, <span class="st">'0'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#### Recode Crop Names (again)</span></span>
<span><span class="va">crop_name_recode2</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">crop_name_and_type_recode</span>,</span>
<span>                            <span class="va">`Crop Code`</span>, <span class="va">`Crop Name 2`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">`Crop Name 2`</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fsa</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">fsa</span>, <span class="va">crop_name_recode2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>`Crop Name`<span class="op">=</span><span class="fu">if_else</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">`Crop Name 2`</span><span class="op">)</span>, <span class="va">`Crop Name`</span>, <span class="va">`Crop Name 2`</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">`Crop Name 2`</span><span class="op">)</span></span>
<span><span class="fu">one_to_one_fails</span><span class="op">(</span><span class="va">fsa</span>, <span class="st">'Crop Name'</span>, <span class="st">'Crop Code'</span><span class="op">)</span></span>
<span><span class="co">## from 22 to 16 rows.</span></span>
<span><span class="co">## actually, many are doubled because I combined tobacco and cotton crop types.</span></span>
<span></span>
<span><span class="co">## Call "turn area"s "idle" with type "turn area".</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">fsa</span>, <span class="va">`Crop Code`</span><span class="op">==</span><span class="st">'0105'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">`Crop Name`</span>, <span class="va">`Crop Type Name`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">fsa</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">fsa</span>, `Crop Type Name`<span class="op">=</span><span class="fu">if_else</span><span class="op">(</span><span class="va">`Crop Name`</span><span class="op">==</span><span class="st">'TURN AREAS'</span>,</span>
<span>                                            <span class="st">'TURN AREAS'</span>, <span class="va">`Crop Type Name`</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fsa</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">fsa</span>, `Crop Name`<span class="op">=</span><span class="fu">if_else</span><span class="op">(</span><span class="va">`Crop Code`</span><span class="op">==</span><span class="st">'0105'</span>,</span>
<span>                                       <span class="st">'IDLE'</span>, <span class="va">`Crop Name`</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#### Recode Crop Type Names (again)</span></span>
<span><span class="va">crop_type_name_recode2</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">crop_name_and_type_recode</span>, <span class="op">-</span><span class="va">`Crop Name`</span>, <span class="op">-</span><span class="va">`Crop Name 2`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">`Crop Type Name 2`</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fsa</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">fsa</span>, <span class="va">crop_type_name_recode2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>`Crop Type Name`<span class="op">=</span><span class="fu">if_else</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">`Crop Type Name 2`</span><span class="op">)</span>,</span>
<span>                                  <span class="va">`Crop Type Name`</span>, <span class="va">`Crop Type Name 2`</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">`Crop Type Name 2`</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># is.missing &lt;- function(x) {is.null(x) | is.na(x)}</span></span>
<span><span class="co">#### If Crop Type Name is missing, so is Crop Type. So What good is Crop Type?</span></span>
<span><span class="co"># filter(fsa_, is.na(`Crop Type Name`) &amp; !is.na(`Crop Type`))</span></span>
<span><span class="co"># filter(fsa_, is.null(`Crop Type Name`) &amp; !is.null(`Crop Type`))</span></span>
<span><span class="co"># filter(fsa_, is.missing(`Crop Type Name`) &amp; !is.missing(`Crop Type`))</span></span>
<span><span class="co"># unique(fsa_[c('Crop Name', 'Crop Type Name', 'Crop Type')]) %&gt;%</span></span>
<span><span class="co">#   filter(!is.na(`Crop Type`) &amp; `Crop Type` != 'NULL') %&gt;%</span></span>
<span><span class="co">#   write.csv('Crop Type Review.csv')</span></span>
<span></span>
<span><span class="va">fsa</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">fsa</span>, <span class="op">-</span><span class="va">`Crop Type`</span>, <span class="op">-</span><span class="va">`Crop Code`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">rename</span><span class="op">(</span>Crop<span class="op">=</span><span class="st">'Crop Name'</span>, Variety<span class="op">=</span><span class="st">'Crop Type Name'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="code-missing-values-as-na">Code Missing Values as NA<a class="anchor" aria-label="anchor" href="#code-missing-values-as-na"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fsa2 &lt;- group_by(fsa, Year, State, County, Crop, Variety, `Irrigation Practice`,</span></span>
<span><span class="co">#                 `Intended Use`, Type) %&gt;%</span></span>
<span><span class="co">#   summarise(Acres=sum(Acres, na.rm=TRUE)) %&gt;%</span></span>
<span><span class="co">#   ungroup() </span></span>
<span></span>
<span><span class="co"># filter(fsa, Variety %in% c('NULL', 'null', 'NA', 'na', '', ' '))</span></span>
<span><span class="co">## 75,205 rows.</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">convert_NAs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">if_else</span><span class="op">(</span><span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'NULL'</span>, <span class="st">'null'</span>, <span class="st">'NA'</span>, <span class="st">'na'</span>, <span class="st">''</span>, <span class="st">' '</span><span class="op">)</span>,</span>
<span>          <span class="cn">NA_character_</span>, <span class="va">x</span><span class="op">)</span> <span class="op">}</span></span>
<span></span>
<span><span class="va">fsa</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">fsa</span>, Variety <span class="op">=</span> <span class="fu">convert_NAs</span><span class="op">(</span><span class="va">Variety</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># filter(fsa, Crop %in% c('NULL', 'null', 'NA', 'na', '', ' ')) ## 0 rows</span></span>
<span><span class="co"># filter(fsa, is.na(Crop)) ## 0 rows</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># filter(fsa, `Irrigation Practice` %in% c('NULL', 'null', 'NA', 'na', '', ' ')) ## 0 rows</span></span>
<span><span class="co"># filter(fsa, is.na(`Irrigation Practice`)) ## 0 rows</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># filter(fsa, `Intended Use` %in% c('NULL', 'null', 'NA', 'na', '', ' ')) ## 0 rows</span></span>
<span><span class="co"># filter(fsa, is.na(`Intended Use`)) ## 313,237 rows</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># filter(fsa, Type %in% c('NULL', 'null', 'NA', 'na', '', ' ')) ## 0 rows</span></span>
<span><span class="co"># filter(fsa, is.na(Type)) ## 0 rows</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># filter(fsa, is.na(Acres)) ## 0 rows</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">county_name_recode</span>, <span class="co"># crop_classification_review, crop_name_and_type_recode,</span></span>
<span>   <span class="va">crop_name_recode</span>, <span class="va">crop_type_name_recode</span><span class="op">)</span></span></code></pre></div>
<p>The Variety column contains values such as “NULL”, “null”, “NA”, and
“na”. Those values have been converted to missing values.</p>
</div>
<div class="section level3">
<h3 id="review-intended-use-values">Review Intended Use Values<a class="anchor" aria-label="anchor" href="#review-intended-use-values"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># group_by(fsa, Year, `Intended Use`) %&gt;%</span></span>
<span><span class="co">#   summarise(Acres=sum(Acres, na.rm=TRUE)) %&gt;%</span></span>
<span><span class="co">#   spread(Year, Acres) %&gt;% write.csv('Intended Use Review.csv')</span></span>
<span></span>
<span><span class="co"># filter(fsa, `Intended Use`=='LF') ## sesame leaves?</span></span>
<span></span>
<span><span class="va">intended_use_recode</span> <span class="op">&lt;-</span> <span class="fu">read_xlsx</span><span class="op">(</span></span>
<span>  <span class="st">"../data-raw/FSA - Clean up the names.xlsx"</span>,</span>
<span>  sheet <span class="op">=</span> <span class="st">'intended use recode 1'</span><span class="op">)</span></span>
<span><span class="va">fsa</span> <span class="op">&lt;-</span> <span class="fu">recode_column_with_table</span><span class="op">(</span><span class="va">fsa</span>, <span class="fl">4</span>, <span class="va">intended_use_recode</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fsa</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">fsa</span>, `Intended Use`<span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">`Intended Use`</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">`Intended Use`</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'CP'</span>, <span class="va">`Intended Use`</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># group_by(fsa, Year, `Intended Use`) %&gt;%</span></span>
<span><span class="co">#   summarise(Acres=sum(Acres, na.rm=TRUE)) %&gt;%</span></span>
<span><span class="co">#   spread(Year, Acres) %&gt;% write.csv('Intended Use Review2.csv')</span></span>
<span></span>
<span><span class="va">intended_use_recode2</span> <span class="op">&lt;-</span> <span class="fu">read_xlsx</span><span class="op">(</span></span>
<span>  <span class="st">"../data-raw/FSA - Clean up the names.xlsx"</span>,</span>
<span>  sheet <span class="op">=</span> <span class="st">'intended use recode 2'</span><span class="op">)</span></span>
<span><span class="va">fsa</span> <span class="op">&lt;-</span> <span class="fu">recode_column_with_table</span><span class="op">(</span><span class="va">fsa</span>, <span class="fl">4</span>, <span class="va">intended_use_recode2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># group_by(fsa, Crop, `Intended Use`) %&gt;%</span></span>
<span><span class="co">#   summarise(Acres=sum(Acres, na.rm=TRUE)) %&gt;%</span></span>
<span><span class="co">#   spread(`Intended Use`, Acres) %&gt;% View()</span></span></code></pre></div>
<p>“Intended Use” from 2009 to 2012 included Conservation Practices.
From 2009 - 2011 the conservation practices are designated by a number,
and in 2012 they are listed in the form of “CP## Description”. From
2013-2021, Conservation Practices appear in the ‘Variety’ Column.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### All of those CP## entries in `Intended Use` have Crop=='CRP'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">fsa</span>, <span class="va">Crop</span> <span class="op">!=</span> <span class="st">'CRP'</span><span class="op">)</span><span class="op">$</span><span class="va">`Intended Use`</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">### Yea, pretty much.</span></span>
<span></span>
<span><span class="co"># filter(fsa, Crop=='CRP' | is.na(Crop))$Type %&gt;% unique()</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">fsa</span>, <span class="va">Crop</span><span class="op">==</span><span class="st">'CRP'</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Crop</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">Crop</span>, <span class="va">Year</span>, <span class="va">Variety</span>, <span class="va">`Intended Use`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>Acres<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Acres</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">spread</span><span class="op">(</span><span class="va">Year</span>, <span class="va">Acres</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fsa_crp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">fsa</span>, <span class="va">Crop</span><span class="op">==</span><span class="st">'CRP'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>Variety <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Variety</span><span class="op">)</span>,</span>
<span>                           <span class="va">`Intended Use`</span>, <span class="va">Variety</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">group_by</span><span class="op">(</span><span class="va">fsa_crp</span>, <span class="va">Crop</span>, <span class="va">Year</span>, <span class="va">Variety</span>, <span class="va">`Intended Use`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>Acres<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Acres</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">spread</span><span class="op">(</span><span class="va">Year</span>, <span class="va">Acres</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="st">'CRP Variety Review.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">CRP_variety_recode</span> <span class="op">&lt;-</span> <span class="fu">read_xlsx</span><span class="op">(</span></span>
<span>  <span class="st">"FSA - Clean up the names.xlsx"</span>,</span>
<span>  sheet <span class="op">=</span> <span class="st">'CRP variety recode'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fsa_crp</span> <span class="op">&lt;-</span> <span class="fu">recode_column_with_table</span><span class="op">(</span><span class="va">fsa_crp</span>, <span class="fl">3</span>, <span class="va">CRP_variety_recode</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#### Some acronyms in the CRP varieties:</span></span>
<span><span class="co">### FWP Farmable Wetland Program</span></span>
<span><span class="co">### MPL Marginal Pasture Land</span></span>
<span><span class="co">### EFCRP   Emergency Forest Conservation Reserve Program</span></span>
<span><span class="co">### SAFE    State Acres for …</span></span>
<span><span class="co">### WL  Wildlife</span></span>
<span></span>
<span><span class="va">fsa_crp</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">fsa_crp</span>, `Intended Use` <span class="op">=</span> <span class="cn">NA_character_</span><span class="op">)</span></span>
<span><span class="fu">select</span><span class="op">(</span><span class="va">fsa_crp</span>, <span class="va">Variety</span>, <span class="va">`Intended Use`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fsa</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">fsa</span>, <span class="va">Crop</span> <span class="op">!=</span> <span class="st">'CRP'</span><span class="op">)</span>, <span class="va">fsa_crp</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">fsa_crp</span>, <span class="va">CRP_variety_recode</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">intended_use_recode</span>, <span class="va">intended_use_recode2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">acresFSA</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">fsa</span>,</span>
<span>                   Year<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   State<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">State</span><span class="op">)</span>,</span>
<span>                   County<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">County</span><span class="op">)</span>,</span>
<span>                   Type<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">Type</span><span class="op">)</span>,</span>
<span>                   `Irrigation Practice`<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">`Irrigation Practice`</span><span class="op">)</span>,</span>
<span>                   Crop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">Crop</span><span class="op">)</span>,</span>
<span>                   Variety<span class="op">=</span><span class="va">Variety</span>,</span>
<span>                   `Intended Use`<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">`Intended Use`</span><span class="op">)</span>,</span>
<span>                   Acres<span class="op">=</span><span class="va">Acres</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/track_dataset.html">track_dataset</a></span><span class="op">(</span><span class="st">"Convert some column types"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">acresFSA</span> <span class="op">&lt;-</span> <span class="va">acresFSA</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">Year</span>, <span class="va">State</span>, <span class="va">County</span>, <span class="va">Type</span>, <span class="va">`Irrigation Practice`</span>, <span class="va">Crop</span>, <span class="va">Variety</span>, <span class="va">`Intended Use`</span>,</span>
<span>         <span class="va">Acres</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_data</span><span class="op">(</span><span class="va">acresFSA</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">data_manipulation_log</span>, <span class="st">'data_cleaning_log.csv'</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by C A Pellett, State of South Carolina Department of Natural Resources.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
